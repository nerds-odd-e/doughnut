---
description: Running tests and commands in terminal - cloud agent vs local development, nix commands, test execution, pnpm commands
alwaysApply: true
---

# Running Commands and Tests - Cloud Agent vs Local Development

## When to Use This Rule

**Use this rule when:**
- Running tests (frontend, backend, e2e)
- Executing terminal commands in the project
- Determining whether to use nix wrapper or run commands directly
- Working as a Cursor cloud agent (background agent)
- Working in local development environment
- Encountering command execution errors
- Setting up test execution

## Environment Detection

### Cloud Agent Environment (Cursor Background Agent)

**How to identify:** You are running on Cursor's cloud virtual machine (not local machine)

**Pre-configured environment:**
- **Node.js**: v22.21.1 ✅ (meets project requirement: >=22)
- **pnpm**: 10.22.0 ✅ (meets project requirement: >=10.22.0)
- **No nix**: Not available (nor needed)
- **Java and MySQL**: May need one-time setup via `source /workspace/scripts/cloud_agent_setup.sh` (for backend tests)

**Command execution:** Run commands **DIRECTLY** without nix prefix

### Local Development Environment

**How to identify:** Running on developer's local machine with nix installed

**Command execution:** MUST use nix wrapper: `CURSOR_DEV=true nix develop -c <command>`

## Running Tests

### Frontend Unit Tests

**Cloud Agent:**
```bash
pnpm frontend:test
```

**Local Development:**
```bash
CURSOR_DEV=true nix develop -c pnpm frontend:test
```

### Backend Unit Tests

**Cloud Agent:**
```bash
# One-time setup (if not already done)
source /workspace/scripts/cloud_agent_setup.sh

# Run tests
pnpm backend:verify
```

**Local Development:**
```bash
CURSOR_DEV=true nix develop -c pnpm backend:verify
```

### E2E Tests

**Cloud Agent:**
```bash
# First, start services in the background
pnpm sut &

# Wait for services to be ready, then run tests
pnpm cypress run --spec e2e_test/features/<feature-file>.feature
```

**Local Development:**
```bash
# First, start services in the background
CURSOR_DEV=true nix develop -c pnpm sut &

# Wait for services to be ready, then run tests
CURSOR_DEV=true nix develop -c pnpm cypress run --spec e2e_test/features/<feature-file>.feature
```

## Key Rules

1. **Cloud agents:** Do NOT use `CURSOR_DEV=true nix develop -c` prefix - run commands directly
2. **Local development:** ALWAYS use `CURSOR_DEV=true nix develop -c` prefix for commands that need the nix environment
3. **Backend tests on cloud:** May require one-time setup script for Java and MySQL
4. **E2E tests:** **MUST start `pnpm sut` in the background first** before running e2e tests (both cloud agent and local development)
5. **Test execution:** Frontend tests verified to work on cloud agents without nix
6. **Linting errors:** TypeScript/vue-tsc errors may appear but don't prevent test execution

## Common Commands Reference

| Command | Cloud Agent | Local Development |
|---------|-------------|-------------------|
| Frontend tests | `pnpm frontend:test` | `CURSOR_DEV=true nix develop -c pnpm frontend:test` |
| Backend tests | `pnpm backend:verify` | `CURSOR_DEV=true nix develop -c pnpm backend:verify` |
| E2E tests | `pnpm cypress run --spec <path>` | `CURSOR_DEV=true nix develop -c pnpm cypress run --spec <path>` |
| Linting | `pnpm lint:all` | `CURSOR_DEV=true nix develop -c pnpm lint:all` |
| Formatting | `pnpm format:all` | `CURSOR_DEV=true nix develop -c pnpm format:all` |
