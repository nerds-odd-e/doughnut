---
description: Running tests and commands in terminal - cloud agent vs local development, nix commands, test execution, pnpm commands
alwaysApply: true
---

# Running Commands and Tests - Cloud Agent vs Local Development

**CRITICAL: On Cloud VM, the `CURSOR_DEV=true nix develop -c` prefix MUST NOT be added to commands. Run commands directly without any nix prefix.**

## When to Use This Rule

**Use this rule when:**
- Running tests (frontend, backend, e2e)
- Executing terminal commands in the project
- Determining whether to use nix wrapper or run commands directly
- Working as a Cursor cloud agent (background agent)
- Working in local development environment
- Encountering command execution errors
- Setting up test execution

## Environment Detection

### Cloud Agent Environment (Cursor Background Agent)

**How to identify:** You are running on Cursor's cloud virtual machine (not local machine)

**Pre-configured environment:**
- **Node.js**: v22.21.1 ✅ (meets project requirement: >=22)
- **pnpm**: 10.22.0 ✅ (meets project requirement: >=10.22.0)
- **No nix**: Not available (nor needed)
- **Java and MySQL**: May need one-time setup via `source /workspace/scripts/cloud_agent_setup.sh` (for backend tests)

**Command execution:** Run commands **DIRECTLY** without nix prefix

### Local Development Environment

**How to identify:** Running on developer's local machine with nix installed

**Command execution:** MUST use nix wrapper: `CURSOR_DEV=true nix develop -c <command>`

**Note:** This rule focuses on Cloud Agent environment. For local development, refer to other workspace rules.

## Running Tests

### Frontend Unit Tests

**Cloud Agent:**
```bash
pnpm frontend:test
```

### Backend Unit Tests

**Cloud Agent:**
```bash
# One-time setup (if not already done)
source /workspace/scripts/cloud_agent_setup.sh

# Run tests
pnpm backend:verify
```

### E2E Tests

**Cloud Agent:**
```bash
# First, start services in the background (only needed for e2e tests)
pnpm sut &

# Wait 10 seconds for services to be ready
sleep 10

# Run tests
pnpm cypress run --spec e2e_test/features/<feature-file>.feature
```

## Key Rules

1. **Cloud agents:** Do NOT use `CURSOR_DEV=true nix develop -c` prefix - run commands directly
2. **Backend tests on cloud:** May require one-time setup script for Java and MySQL
3. **E2E tests:** **MUST start `pnpm sut` in the background first, wait 10 seconds, then run tests** (only needed for e2e tests, not for unit tests)
4. **Test execution:** Frontend tests verified to work on cloud agents without nix
5. **Linting errors:** TypeScript/vue-tsc errors may appear but don't prevent test execution

## Common Commands Reference

| Command | Cloud Agent |
|---------|-------------|
| Frontend tests | `pnpm frontend:test` |
| Backend tests | `pnpm backend:verify` |
| E2E tests | `pnpm sut &` then `sleep 10` then `pnpm cypress run --spec <path>` |
| Linting | `pnpm lint:all` |
| Formatting | `pnpm format:all` |
