@usingMockedOpenAiService
Feature: Understanding Check
  As a learner, when I start assimilating a note, I want to have the key
  points I should understand from the note generated by AI,
  delete selected points to have AI remove related content from note details,
  and promote a point to a child or sibling note.
  So that I can check whether I truly understood the important points,
  especially when the note is long.

  Background:
    Given I am logged in as an existing user
    And I have a notebook with the head note "Parent" and details ""
    And there are some notes:
      | Title | Parent Title | Details     |
      | Sample | Parent      | A. B. C. D. E. |
    And OpenAI generates understanding checklist with points:
      | A |
      | B |
      | C |
      | D |
      | E |

  Scenario: Generate understanding checklist for a note
    When I am assimilating the note "Sample"
    Then I should see an understanding checklist with 5 points

  Scenario: Delete selected understanding points
    Given OpenAI returns the following details when requested to delete points:
      | B. D. E. |
    When I am assimilating the note "Sample"
    And I delete understanding points 0 and 2
    Then the note details on the current page should be "B. D. E."

  Scenario: Ignored points' questions do not appear on recall page
    When I am assimilating the note "Sample"
    And I ignore these understanding points and complete assimilation:
      | A |
      | C |

  Scenario: Promote a point from understanding checklist to child note
    Given OpenAI will extract point "B" to child note with title "Point B" and details "Extracted from B" and updated parent details "A. C. D. E."
    When I am assimilating the note "Sample"
    And I should see an understanding checklist with 5 points
    And I promote the point "B" to a child note
    Then I should see "Parent/Sample" with these children
      | note-title |
      | Point B    |

  Scenario: Promote a point to sibling note
    Given OpenAI will extract point "B" to sibling note with title "Point B" and details "Extracted" and updated parent details "A. C. D. E."
    When I am assimilating the note "Sample"
    And I should see an understanding checklist with 5 points
    And I promote the point "B" to a sibling note
    Then I should see "Parent" with these children
      | note-title |
      | Sample     |
      | Point B    |
